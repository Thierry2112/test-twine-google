<!DOCTYPE html>
<html>
<head>
  <title>Twine Game</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
  <script>
    // Configuration Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyApjsHWCZdEz6it9o2jmy6JyDJANwLFfYA",
      authDomain: "twine-ed02f.firebaseapp.com",
      databaseURL: "https://twine-ed02f.firebaseio.com",
      projectId: "twine-ed02f",
      storageBucket: "twine-ed02f.appspot.com",
      messagingSenderId: "220597865723",
      appId: "1:220597865723:web:396d7f579d637fff4f345e"
    };

    // Initialiser Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    // Enregistrer le nombre dans Firebase
    function saveNumber(player) {
      var number = document.getElementById('player' + player + 'Number').value;
      var ref = database.ref('players/player' + player);
      ref.set({
        number: parseInt(number)
      }).then(function() {
        if (player === 1) {
          SugarCube.Engine.go('Joueur2');
        } else {
          calculateResults();
        }
      });
    }

    // Calculer les résultats
    function calculateResults() {
      var ref1 = database.ref('players/player1/number');
      var ref2 = database.ref('players/player2/number');
      ref1.once('value').then(function(snapshot1) {
        var number1 = snapshot1.val();
        ref2.once('value').then(function(snapshot2) {
          var number2 = snapshot2.val();
          var sum = number1 + number2;
          var percentage1 = (number1 / sum) * 100;
          var percentage2 = (number2 / sum) * 100;
          displayResults(percentage1, percentage2);
        });
      });
    }

    // Afficher les résultats
    function displayResults(percentage1, percentage2) {
      var resultText = "Joueur 1: " + percentage1.toFixed(2) + "%\n" +
                       "Joueur 2: " + percentage2.toFixed(2) + "%";
      alert(resultText);
      SugarCube.Engine.go('Introduction');
    }
  </script>
</head>
<body>
  <tw-story>
    <!-- Ton histoire Twine exportée ici -->
    <tw-passagedata pid="1" name="Introduction">
      Bienvenue au jeu. Choisissez votre rôle :
      [[Joueur 1|Joueur1]]
      [[Joueur 2|Joueur2]]
    </tw-passagedata>

    <tw-passagedata pid="2" name="Joueur1">
      <<set $player = 1>>
      Entrez un nombre entre 1 et 100 :
      <input type="number" id="player1Number" min="1" max="100">
      <button onclick="saveNumber(1)">Envoyer</button>
      [[Résultat|Resultat]]
    </tw-passagedata>

    <tw-passagedata pid="3" name="Joueur2">
      <<set $player = 2>>
      Entrez un nombre entre 1 et 100 :
      <input type="number" id="player2Number" min="1" max="100">
      <button onclick="saveNumber(2)">Envoyer</button>
      [[Résultat|Resultat]]
    </tw-passagedata>

    <tw-passagedata pid="4" name="Resultat">
      Les nombres ont été enregistrés. Veuillez attendre les résultats...
    </tw-passagedata>
  </tw-story>
</body>
</html>
